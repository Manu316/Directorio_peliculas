{% extends "movies/base.html" %}

{% block title %}Buscar en TMDb{% endblock %}

{% block content %}
    <h1>Buscar Películas</h1>
    <p class="lead">Busca el título en la base de datos de películas y añádelo a tu colección.</p>

    <form class="mb-4" method="GET" action="{% url 'search_movie' %}">
        <div class="input-group">
            <input type="text" name="q" class="form-control" placeholder="Escribe el título de una película..." value="{{ query|default:'' }}">
            <button class="btn btn-primary" type="submit">Buscar</button>
        </div>
    </form>

    {% if query and not results %}
        <div class="alert alert-warning">
            No se encontraron resultados para "{{ query }}".
        </div>
    {% elif results %}
        <h2>Resultados para "{{ query }}"</h2>
        <div class="row row-cols-1 row-cols-md-2 g-3">
            {% for movie_api in results %}
                <div class="col">
                    <div class="card h-100 d-flex flex-row">
                        {% with poster_url='https://image.tmdb.org/t/p/w92'|add:movie_api.poster_path %}
                            <img src="{{ poster_url }}" class="img-fluid rounded-start" style="width: 92px; height: 138px;" alt="{{ movie_api.title }}">
                        {% endwith %}
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title mb-1">{{ movie_api.title }}</h5>
                            <p class="card-text text-muted small mb-2">
                                {{ movie_api.release_date|date:"Y"|default:"Fecha desconocida" }}
                            </p>
                            <p class="card-text small text-truncate">{{ movie_api.overview }}</p>
                            
                            <form method="POST" action="{% url 'add_movie_from_tmdb' %}" class="mt-auto">
                                {% csrf_token %}
                                <input type="hidden" name="tmdb_id" value="{{ movie_api.id }}">
                                <input type="hidden" name="title" value="{{ movie_api.title }}">
                                <input type="hidden" name="release_date" value="{{ movie_api.release_date }}">
                                <input type="hidden" name="poster_path" value="{{ movie_api.poster_path }}">
                                
                                <button type="submit" class="btn btn-success btn-sm w-100">Añadir a mi Colección</button>
                            </form>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endblock content %}